# from flask import Flask, render_template
# import pytest
# app = Flask(__name__)

# @app.route('/')
# def index():
#   return render_template('index.html')

# @app.route('/my-link/')
# def my_link():
#   print ('I got clicked!')
#   # pytest.main(['>output.html'])
#   pytest.main(['-s',' --html=/templates/report.html', '--self-contained-html'])
#   return render_template('report.html')

# if __name__ == '__main__':
#   app.run(debug=True)

import os
os.environ.setdefault('FLASK_APP', 'otr')
os.environ.setdefault('FLASK_DEBUG', 'true')

import flask,os
from shelljob import proc


app = flask.Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

@app.route( '/stream' )
def stream():
    g = proc.Group()
    p = g.run( [ "pytest -s"] )

    def read_process():
        while g.is_pending():
            lines = g.readlines()
            for proc, line in lines:
                yield line

    return flask.Response( read_process(), mimetype= 'text/plain' )

app.run(debug=True)